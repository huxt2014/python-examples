

"""
                +--------+
                | Server |
                +--------+
                     |
           environ + start_response

  +------------------|-------------------------------------------------------+
  | Flask            |                                                       |
  |                                                                          |
  |   +-------- bind context ------+                                         |
  |   |                            |                  +----------+           |
  |   |  init and push request ctx |    +-----------> |    rv    |           |
  |   |              |             |    |             +----------+           |
  |   |   init and push app ctx    |    |                   |                |
  |   |              |             |    |      +--------finalize---------+   |
  |   +--------------|-------------+    |      |            |            |   |
  |                                     |      |      make_response      |   |
  |     before_first_request_funcs      |      |            |            |   |
  |                 |                   |      | after_request_functions |   |
  |   +------- pre-process --------+    |      |            |            |   |
  |   |                            |    |      |       save session      |   |
  |   |  url_value_preprocessors   |    |      |            |            |   |
  |   |             |              |    |      +------------|------------+   |
  |   |   before_request_funcs     |    |                                    |
  |   |             |              |    |      +----- unbind context ----+   |
  |   +-------------|--------------+    |      |                         |   |
  |                                     |      |    do_teardown_request  |   |
  |   +---------dispatch-----------+    |      |            |            |   |
  |   |                            |    |      |    pop request context  |   |
  |   |       view_functions       |    |      |            |            |   |
  |   |             |              -----+      |  do_teardown_appcontext |   |
  |   |       handle exception     |           |            |            |   |
  |   |          if raised         |           |      pop app context    |   |
  |   +----------------------------+           |            |            |   |
  |                                            +------------|------------+   |
  |                                                         |                |
  |                                                   +----------+           |
  |                                                   | Response |           |
  |                                                   +----------+           |
  +---------------------------------------------------------|----------------+



                                         +---------------------------+
                                         |Server                     |
                                         |                           |
                                         |    +-----------------+    |
    +--------+         +-------+         |    |Middleware       |    |
    |        | ----->  |       | ----->  |    |                 |    |
    | Client |         | Proxy |         |    |    +-------+    |    |
    |        | <-----  |       | <-----  |    |    | Flask |    |    |
    +--------+         +-------+         |    |    +-------+    |    |
                                         |    +-----------------+    |
                                         |                           |
                                         +---------------------------+
"""
